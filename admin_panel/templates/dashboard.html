{% extends 'base.html' %}
{% load static  %}

{% block content %}

<script src="https://kit.fontawesome.com/a076d05399.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script
src="https://code.jquery.com/jquery-3.6.4.min.js"
integrity="s127.0.0.1:8000z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
crossorigin="anonymous">
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-v4-grid-only@1.0.0/dist/bootstrap-grid.min.css">




<div class="main-panel" id="main-panel" style="margin-right: 200px; background-color: rgb(77, 76, 76);">
  <div class="content" style="margin-top: 50px; margin-right: 50px;" dir="rtl">

    <div style="display: flex; gap: 0; font-size: 10px;">
      <div style="height: 70px; margin-left: 1300px; display: flex; gap: 10px;">
        <h5 style="color: white;">الرئيسية</h5>
        <h5><i class="now-ui-icons arrows-1_minimal-left" style="margin-top: 3px; color: rgb(189, 9, 189);"></i></h5>
      </div>
    </div>
    
    <div class="row" style="color: white;">
      <div class="col-lg-4">
        <div class="card card-chart" style="width: 250px; height: 130px; background-color: rgb(47, 48, 48);">
          <div class="card-header">
            <h4 class="card-title" style="text-align: center; border-bottom: solid; border-color: rgb(189, 9, 189);">عدد الحجاج</h4>
          </div>
          <div class="card-body">
            <div class="chart-area" style="text-align: center; font-size: x-large;">
              {{total_pilgrims}}
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="card card-chart" style="width: 250px; height: 130px; background-color: rgb(47, 48, 48);">
          <div class="card-header">
            <h4 class="card-title" style="text-align: center; border-bottom: solid; border-color: rgb(189, 9, 189);">عدد الموظفين</h4>
          </div>
          <div class="card-body">
            <div class="chart-area" style="text-align: center; font-size: x-large;">
             {{total_employees}}
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="card card-chart" style="width: 250px; height: 130px; background-color: rgb(47, 48, 48);">
          <div class="card-header">
            <h4 class="card-title" style="text-align: center; border-bottom: solid; border-color: rgb(189, 9, 189);">عدد استمارات التسجيل</h4>
          </div>
          <div class="card-body">
            <div class="chart-area" style="text-align: center;  font-size: x-large;">
              {{total_forms}}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row" style="color: white;">
      <div class="col-md-6">
        <div class="card card-chart" style="width: 250px; height: 130px; background-color: rgb(47, 48, 48); margin-right: 140px;">
          <div class="card-header">
            <h4 class="card-title" style="text-align: center; border-bottom: solid; border-color: rgb(189, 9, 189);">عدد الاداريين </h4>
          </div>
          <div class="card-body">
            <div class="chart-area" style="text-align: center;  font-size: x-large;">
              {{total_managers}}
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card card-chart" style="width: 250px; height: 130px; margin-left: 100px; background-color: rgb(47, 48, 48);">
          <div class="card-header">
            <h4 class="card-title" style="text-align: center; border-bottom: solid; border-color: rgb(189, 9, 189);">عدد المرشدين</h4>
          </div>
          <div class="card-body">
            <div class="chart-area" style="text-align: center;  font-size: x-large;">
              {{total_guides}}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container" style="margin-top: 150px; margin-right: 50px; background-color: rgb(57, 58, 58); border-radius: 10px; padding: 30px; width: 160vh;">
    <div class="row">
      <div class="col-6">
        <canvas id="spendPerCustomerChart"></canvas>
      </div>
      <div class="col-6">
        <canvas id="paymentMethodChart"></canvas>
      </div>
    </div>
    </div>
  
  
  </div>

</div>














<script>
    let spendPerCustomerCtx = document.getElementById("spendPerCustomerChart").getContext("2d");
    let spendPerCustomerChart = new Chart(spendPerCustomerCtx, {
      type: "line",
      options: {
        responsive: true,
        title: {
          display: false,
          text: ""
        },
          scales: {
            x: {
            ticks: {
              font: {
                color: 'white', // Set the font color to white
              }
            }
          },
            y: {
          ticks: { 
            stepSize: 1, // Set the distance between y-axis labels to 1
            beginAtZero: true, // Ensure the scale starts at 0
            font: {
                color: 'white', // Set the font color to white
              }
          }
        }
      }
      }
    });





  let paymentMethodCtx = document.getElementById("paymentMethodChart").getContext("2d");
  let paymentMethodChart = new Chart(paymentMethodCtx, {
     type: "pie",
     options: {
       responsive: true,
       maintainAspectRatio: false,
       aspectRatio: 1,
       title: {
         display: false,
         text: "المهام"
       },
       layout: {
         padding: {
           left: 0,
           right: 0,
           top: 0,
           bottom: 25
         }
       },


       plugins: {
            legend: {
                labels: {
                    font: {
                        family: 'Arial', // Specify the font family
                        size: 14, // Specify the font size
                        style: 'normal', // Specify the font style
                        weight: 'bold' // Specify the font weight
                    }
                }
            }
        }

     }
  });
 </script>
 
 <script>
  $("#filterForm").on("submit", (event) => {
     event.preventDefault();
     // Assuming you want to load the chart when the form is submitted
     loadAllCharts();
  });


  function loadChart2(chart, endpoint) {
 $.ajax({
    url: endpoint,
    type: "GET",
    dataType: "json",
    success: (jsonResponse) => {
      const title = "Latest Pilgrims Joining";

      // Define all months of the year
      const allMonths = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];

      // Initialize an object to hold the counts for each month
      let monthCounts = {};
      allMonths.forEach(month => {
        monthCounts[month] = 0; // Initialize all months with a count of 0
      });

      // Update counts based on the API response
      jsonResponse.data.datasets.forEach(dataset => {
        dataset.data.forEach(item => {
          monthCounts[item.month_name] = item.count;
        });
      });

      // Prepare labels and data for the chart
      let labels = allMonths;
      let data = allMonths.map(month => monthCounts[month]);

      // Reset the current chart
      chart.data.datasets = [];
      chart.data.labels = [];

      // Load new data into the chart
      chart.options.title.text = title;
      chart.options.title.display = true;
      chart.data.labels = labels;
      chart.data.datasets.push({
        label: 'Pilgrims',
        data: data,
        borderColor: 'rgba(75, 192, 192, 1)',
        fill: false,
        backgroundColor: '#FFFFFF'
      });


      chart.options.scales = {
        x: {
          ticks: {
            font: {
              color: 'white', // Set the font color to white
            }
          }
        },
        y: {
          ticks: {
            font: {
              color: 'white', // Set the font color to white
            },
            stepSize: 1, // Set the distance between y-axis labels to 1
            beginAtZero: true // Ensure the scale starts at 0
          }
        }
      };

      chart.update(); 
    },
    error: () => console.log("Failed to fetch chart data from " + endpoint + "!")
 });
}



 
  function loadChart(chart, endpoint) {
     $.ajax({
       url: endpoint,
       type: "GET",
       dataType: "json",
       success: (jsonResponse) => {
         // Extract data from the response
         const completed = jsonResponse.completed;
         const remaining = jsonResponse.remaining;
 
         // Reset the current chart
         chart.data.datasets = [];
         chart.data.labels = [];
 
         // Prepare data for the chart
         const labels = ['المهام المنتهية', 'المهام المتبقية'];
         const data = [completed, remaining];
 
         // Load new data into the chart
         chart.data.labels = labels;
         chart.data.datasets.push({
           data: data,
           backgroundColor: ['#007bff', '#dc3545'] // Example colors, adjust as needed
         });
         chart.update(); 
       },
       error: () => console.log("Failed to fetch chart data from " + endpoint + "!")
     });
  }
 
  function loadAllCharts() {
    loadChart2(spendPerCustomerChart, `http://85.31.237.33/test/api/chart/line-chart/`);
    loadChart(paymentMethodChart, `http://85.31.237.33/test/api/chart/pie-chart/`);
  }

  loadAllCharts();
 </script>


{% endblock content %}