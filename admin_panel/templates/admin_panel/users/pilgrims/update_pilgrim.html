{% extends 'base.html' %}
{% load static  %}
{% load widget_tweaks %}

{% block content %}

<div class="main-panel" id="main-panel" style="background-color: rgb(77, 76, 76);">
    <div class="content" dir="rtl" style="margin-top: 10px;">
  
        <div class="bread-crumbs-size" style="display: flex; gap: 0;">
          <div style="height: 70px; margin-left: 1300px; display: flex; gap: 10px;">
            <a href="{% url 'main_dashboard' %}" style="text-decoration: none;"><h5 style="color: white;">الرئيسية</h5></a>
            <h5><i class="now-ui-icons arrows-1_minimal-left bread-crumbs-arrow" style="margin-top: 3px;"></i></h5>
            <a href="{% url 'pilgrims' %}" style="text-decoration: none;"><h5 style="color: white;">الحجاج</h5></a>
            <h5><i class="now-ui-icons arrows-1_minimal-left bread-crumbs-arrow" style="margin-top: 3px;"></i></h5>
            <h5 style="color: white;">تعديل</h5>
            <h5><i class="now-ui-icons arrows-1_minimal-left bread-crumbs-arrow" style="margin-top: 3px;"></i></h5>
          </div>
        </div>


        <div style="display: flex; gap: 5px; color: white; font-size: smaller;" dir="ltr">
          <a href="{% url 'change_password' user_id %}" style="text-decoration: none;"><h5 class="change-button" style="background-color: #969696;">تعديل كلمة المرور</h5></a>
        </div>


        <div>
            <form action="" method="post" enctype="multipart/form-data" style="display: flex; flex-direction: column; gap: 70px; color: white;">
                {% csrf_token %}

                <div style="background-color: rgb(57, 58, 58); width: 100%; height: auto;display: flex; flex-direction: column; justify-content: space-evenly; border-radius: 30px; gap: 0px;" dir="rtl">
                  
                  <h4 style="text-align: center">المعلومات الشخصية</h4>
    
                  <div style="background-color: rgb(57, 58, 58); width: 100%; display: flex;gap: 10px;justify-content: space-evenly;border-radius: 30px; display: flex; justify-content: space-evenly;" >
                    <div class="form-block">

                      <div class="form-input">
                        <div class="form-label">{{ form.first_name.label_tag }}</div>
                        <div>{{ form.first_name|add_class:"form-control" }}</div>
                      </div>    

                      <div class="form-input">
                        <div class="form-label">{{ form.father_name.label_tag }}</div>
                        <div>{{ form.father_name|add_class:"form-control" }}</div> 
                      </div>

                      <div class="form-input">
                        <div class="form-label">{{ form.grand_father.label_tag }}</div>
                        <div>{{ form.grand_father|add_class:"form-control" }}</div> 
                      </div>    

                      <div class="form-input" style="text-align: right;">
                        <div class="form-label">الصورة الشخصية:</div>
                        <div class="current-image-wrapper">
                            <img src="{{ pilgrim_image }}" alt="Current Image" class="current-image">
                            <div class="form-input"><input type="file" name="pilgrim_image" id="pilgrim_image" class="my-img"></div>
                        </div>
                      </div>

                      <div class="form-input" style="display: flex; align-items: center; justify-content: right; gap: 40px;">
                        <div class="form-label">{{ form.get_notifications.label_tag }}</div>
                        <div class="form-input" style="padding-top: 27px;">{{ form.get_notifications|add_class:"form-control-check" }}</div> 
                      </div>

                    </div>
    
                    <div class="form-block">
                        <div class="form-input">
                          <div class="form-label">{{ form.last_name.label_tag }}</div>
                          <div>{{ form.last_name|add_class:"form-control" }}</div> 
                        </div>
                        <div class="form-input">
                          <div class="form-label">{{ form.registeration_id.label_tag }}</div>
                          <div>{{ form.registeration_id|add_class:"form-control" }}</div> 
                        </div>
                        <div class="form-input" style="flex-direction: column;">
                          <div class="form-label">{{ form.phonenumber.label_tag }}</div>
                          <div>{{ form.phonenumber|add_class:"form-control" }}</div>
                        </div>
                        <div class="form-input" style="flex-direction: column;">
                          <div class="form-label">{{ form.guide.label_tag }}</div>
                          <div>{{ form.guide|add_class:"form-control" }}</div>
                        </div>
                        <div class="form-input-datetime">
                          <div class="form-label">{{ form.birthday.label_tag }}</div>
                          <div><input type="date" class="date-field" name="birthday" value="{{form.birthday.value|date:'Y-m-d'}}"></div>
                        </div>
                      </div>

                  </div>
                </div>


                
                <div style="background-color: rgb(57, 58, 58); width: 100%;display: flex;gap: 10px;justify-content: space-evenly;border-radius: 30px; height: auto;display: flex; flex-direction: column; justify-content: flex-start; gap: 0px; padding-bottom: 10px;">
                  
                  <h4 style="text-align: center">معلومات الرحلة</h4>
                  
                  <div  style="display: flex; justify-content: space-evenly;">
                    <div class="form-block">
                      <div class="form-input">
                        <div class="form-label">{{ form.flight_num.label_tag }}</div>
                        <div>{{ form.flight_num|add_class:"form-control" }}</div>
                      </div>
                      <div class="form-input-datetime">
                        <div class="form-label">{{ form.arrival.label_tag }}</div>
                        <div><input type="time" class="time-field" name="arrival" value="{{form.arrival.value|time:'h:i:s'}}"></div> 
                      </div>
                      <div class="form-input-datetime">
                        <div class="form-label">{{ form.departure.label_tag }}</div>
                        <div><input type="time" class="time-field" name="departure" value="{{form.departure.value|time:'h:i:s'}}"></div>
                      </div>

                      <div class="form-input">
                        <div class="form-label">{{ form.from_city.label_tag }}</div>
                        <div>{{ form.from_city|add_class:"form-control" }}</div> 
                      </div>

                      <div class="form-input">
                        <div class="form-label">{{ form.to_city.label_tag }}</div>
                        <div>{{ form.to_city|add_class:"form-control" }}</div> 
                      </div>
                    </div>
                    
                    <div class="form-block">

                      <div class="form-input">
                        <div class="form-label">{{ form.flight_company.label_tag }}</div>
                        <div>{{ form.flight_company|add_class:"form-control" }}</div>
                      </div>

                      <div class="form-input-datetime">
                        <div class="form-label">{{ form.flight_date.label_tag }}</div>
                        <div><input type="date" class="date-field" name="flight_date" value="{{form.flight_date.value|date:'Y-m-d'}}"></div>
                      </div>

                      <div class="form-input">
                        <div class="form-label">{{ form.duration.label_tag }}</div>
                        <div>{{ form.duration|add_class:"form-control" }}</div>
                      </div>


                      <div class="form-input-datetime">
                        <div class="form-label">{{ form.boarding_time.label_tag }}</div>
                        <div><input type="time" class="time-field" name="boarding_time" value="{{ form.boarding_time.value|time:'h:i:s' }}"></div> 
                      </div>




                      <div class="form-input">
                        <div class="form-label">{{ form.gate_num.label_tag }}</div>
                        <div>{{ form.gate_num|add_class:"form-control" }}</div> 
                      </div>
                      <div class="form-input" style="text-align: right; margin-top: 5px;">
                        <div class="form-label">شعار الشركة:</div>
                        <div class="current-image-wrapper">
                            <img src="{{ company_logo }}" alt="Current Image" class="current-image">
                            <div class="form-input"><input type="file" name="image" id="image_id" class="my-img"></div>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                </div>
                

                
                <div style="background-color: rgb(57, 58, 58); width: 100%;display: flex;gap: 10px;justify-content: space-evenly;border-radius: 30px; height: auto;display: flex; flex-direction: column; justify-content: flex-start; gap: 0px; padding-bottom: 20px;">
                  
                  <h4 style="text-align: center">معلومات الاقامة </h4>
                  
                  <div  style="display: flex; justify-content: space-evenly;">

                    <div class="form-block">

                      <div class="form-input">
                        <div class="form-label">{{ form.hotel.label_tag }}</div>
                        <div>{{ form.hotel | add_class:"form-control" }}</div> 
                      </div>   

                      <div class="form-input">
                        <div class="form-label">{{ form.hotel_address.label_tag }}</div>
                        <div>{{ form.hotel_address | add_class:"form-control" }}</div>
                      </div>   

                    </div>

                    
                    <div class="form-block">

                      <div class="form-input">
                        <div class="form-label">{{ form.room_num.label_tag }}</div>
                        <div>{{ form.room_num|add_class:"form-control" }}</div>
                      </div>

                    </div>
                    
                  </div>


                </div>
                
            
                
                <div style="background-color: rgb(57, 58, 58); width: 100%;display: flex;gap: 10px;justify-content: space-evenly;border-radius: 30px; height: auto;display: flex; flex-direction: column; justify-content: flex-start; gap: 0px; padding-bottom: 20px;">
                  
                  <h4 style="text-align: center">خطوات الحملة </h4>
                  
                  <div  style="display: flex; justify-content: center">
                    <div class="form-block" style="display: flex; flex-direction: column; align-items: center;">
                      {% for step in pilgrim_steps %}
                      <div class="steps-container">
                        <h5>{{step.rank}}- {{step.name}}</h5>
                        {% if step.completed %}
                          <i class="fas fa-check"></i>
                        {% else %}
                          <i class="fas fa-circle-xmark"></i>
                        {% endif %}
                      </div>


                      {% endfor %}

                    </div>  
                  </div>

                </div>



              <!-- Add Map Container -->
              <div class="map-container" style="padding: 0 20px;">
                <div id="map"></div>
              </div>
                
                <div style="display: flex; gap: 10px; justify-content: left;">
                  <input type="submit" value="حفظ" class="save-button">
                </div>

                
              </form>
          </div>

    </div>
</div>

{% endblock content %}

{% block extra_head %}
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
<style>
    #map {
        height: 400px;
        width: 100%;
        margin: 20px 0;
        border-radius: 10px;
    }
</style>
{% endblock %}

{% block extra_scripts %}
<script>
    function initMap() {
        // Default coordinates (Mecca)
        const defaultLocation = { lat: 21.4225, lng: 39.8262 };
        
        // Create map
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 13,
            center: defaultLocation,
        });

        // Create marker
        let marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            draggable: true
        });

        // Update marker position when dragged
        google.maps.event.addListener(marker, 'dragend', function(event) {
            document.getElementById("id_latitude").value = event.latLng.lat();
            document.getElementById("id_longitude").value = event.latLng.lng();
        });
    }

    // Initialize map when page loads
    window.addEventListener('load', initMap);
</script>
{% endblock %}
