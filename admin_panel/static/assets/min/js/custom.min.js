document.addEventListener('DOMContentLoaded',function(){const actionButtons=document.querySelectorAll('.action-button');actionButtons.forEach(button=>{button.addEventListener('mouseover',function(){this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';});button.addEventListener('mouseout',function(){this.style.transform='translateY(0)';this.style.boxShadow='none';});});const sidebar=document.querySelector('.sidebar');const mainPanel=document.querySelector('.main-panel');const isMobile=window.innerWidth<=768;if(!isMobile){if(sidebar){sidebar.addEventListener('wheel',(e)=>{e.stopPropagation();});}}
if(typeof PerfectScrollbar!=='undefined'){const scrollElements=document.querySelectorAll('.sidebar, .main-panel');scrollElements.forEach(element=>{if(element._ps){element._ps.destroy();}
element.classList.remove('ps');element.classList.remove('ps--active-y');element.classList.remove('ps--active-x');});}});function clickHandler(event){if(!event.target.closest('.checkbox-cell')){window.location.href=event.currentTarget.getAttribute('data-link');}}
document.addEventListener('DOMContentLoaded',function(){const modal=document.getElementById('deleteConfirmModal');const deleteButtons=document.querySelectorAll('.delete-btn');const deleteForm=document.getElementById('deleteForm');const deleteConfirmText=document.getElementById('deleteConfirmText');const closeButtons=document.querySelectorAll('.close-modal');deleteButtons.forEach(button=>{button.addEventListener('click',function(){const id=this.getAttribute('data-id');const name=this.getAttribute('data-name');const deleteUrl=this.getAttribute('data-delete-url');deleteForm.action=deleteUrl;modal.style.display='block';document.body.style.overflow='hidden';});});closeButtons.forEach(button=>{button.addEventListener('click',function(){modal.style.display='none';document.body.style.overflow='';});});window.addEventListener('click',function(event){if(event.target===modal){modal.style.display='none';document.body.style.overflow='';}});document.addEventListener('keydown',function(event){if(event.key==='Escape'&&modal.style.display==='block'){modal.style.display='none';document.body.style.overflow='';}});});function clickHandler(event){if(!event.target.closest('button')){const link=event.currentTarget.dataset.link;if(link){window.location.href=link;}}}
document.addEventListener('DOMContentLoaded',function(){function setupPasswordToggle(passwordInput){const container=document.createElement('div');container.className='password-field-container';passwordInput.parentNode.insertBefore(container,passwordInput);container.appendChild(passwordInput);const toggleButton=document.createElement('button');toggleButton.type='button';toggleButton.className='password-toggle';toggleButton.innerHTML='<i class="fas fa-eye"></i>';container.appendChild(toggleButton);toggleButton.addEventListener('click',function(){const type=passwordInput.type==='password'?'text':'password';passwordInput.type=type;toggleButton.innerHTML=`<i class="fas fa-eye${type === 'password' ? '' : '-slash'}"></i>`;});}
const passwordFields=document.querySelectorAll('input[type="password"]');passwordFields.forEach(setupPasswordToggle);});document.addEventListener('DOMContentLoaded',function(){document.body.addEventListener('htmx:configRequest',function(event){const urlParams=new URLSearchParams(window.location.search);const searchQuery=urlParams.get('q');if(searchQuery&&!event.detail.parameters['q']){event.detail.parameters['q']=searchQuery;}
const stepCheckboxes=document.querySelectorAll('.step-checkbox:checked');if(stepCheckboxes.length>0){const selectedStepIds=Array.from(stepCheckboxes).map(cb=>cb.value).join(',');event.detail.parameters['step_ids']=selectedStepIds;}});const stepCheckboxes=document.querySelectorAll('.step-checkbox');stepCheckboxes.forEach(checkbox=>{checkbox.addEventListener('change',function(){const tagElement=this.nextElementSibling;if(this.checked){tagElement.classList.add('active');}else{tagElement.classList.remove('active');}
const checkedBoxes=document.querySelectorAll('.step-checkbox:checked');const selectedIds=Array.from(checkedBoxes).map(cb=>cb.value).join(',');updateUrlParams('step_ids',selectedIds);});});const statusDropdown=document.getElementById('status-filter');if(statusDropdown){statusDropdown.addEventListener('change',function(){updateUrlParams('status',this.value);});}
function updateUrlParams(paramName,paramValue){const urlParams=new URLSearchParams(window.location.search);if(paramValue){urlParams.set(paramName,paramValue);}else{urlParams.delete(paramName);}
const newUrl=window.location.pathname+'?'+urlParams.toString();window.location.href=newUrl;}});if(typeof window.django!=='undefined'&&window.django.jQuery){window.django.jQuery(function($){if(typeof $.fn.djangoTemplateFilters!=='undefined'){$.fn.djangoTemplateFilters.split=function(value,delimiter){if(!value)return[];return value.split(delimiter||',');};}});}
document.addEventListener('DOMContentLoaded',function(){const form=document.getElementById('importForm');const loadingModal=document.getElementById('loadingModal');if(form&&loadingModal){form.addEventListener('submit',function(e){e.preventDefault();loadingModal.style.display='block';setTimeout(()=>loadingModal.classList.add('show'),10);const formData=new FormData(this);fetch(this.action,{method:'POST',body:formData,}).then(response=>{if(response.redirected){window.location.href=response.url;}}).catch(error=>{console.error('Error:',error);loadingModal.style.display='none';loadingModal.classList.remove('show');alert('حدث خطأ أثناء استيراد البيانات. يرجى المحاولة مرة أخرى.');});});}});document.addEventListener('DOMContentLoaded',function(){initSearchableDropdowns();function initSearchableDropdowns(){const searchInputs=document.querySelectorAll('.search-input');searchInputs.forEach(input=>{const targetId=input.getAttribute('data-target');const select=document.getElementById(targetId);if(!select)return;const dropdownOptions=document.createElement('div');dropdownOptions.className='dropdown-options';input.parentNode.appendChild(dropdownOptions);input.setAttribute('data-selection-made','false');const options=Array.from(select.options);options.forEach(option=>{if(option.value){const optionElement=document.createElement('div');optionElement.className='dropdown-option';optionElement.setAttribute('data-value',option.value);optionElement.textContent=option.textContent;dropdownOptions.appendChild(optionElement);if(option.selected){optionElement.classList.add('selected');input.value=option.textContent;input.setAttribute('data-selection-made','true');}
optionElement.addEventListener('click',function(){select.value=this.getAttribute('data-value');input.value=this.textContent;input.setAttribute('data-selection-made','true');dropdownOptions.classList.remove('show');dropdownOptions.querySelectorAll('.dropdown-option').forEach(opt=>{opt.classList.remove('selected');});this.classList.add('selected');const event=new Event('change',{bubbles:true});select.dispatchEvent(event);});}});input.addEventListener('focus',function(){dropdownOptions.classList.add('show');});input.addEventListener('input',function(){input.setAttribute('data-selection-made','false');select.value='';const searchText=this.value.toLowerCase();const options=dropdownOptions.querySelectorAll('.dropdown-option');options.forEach(option=>{const optionText=option.textContent.toLowerCase();if(optionText.startsWith(searchText)){option.classList.remove('hidden');}else{option.classList.add('hidden');}});});document.addEventListener('click',function(e){if(!input.contains(e.target)&&!dropdownOptions.contains(e.target)){dropdownOptions.classList.remove('show');if(input.getAttribute('data-selection-made')==='false'&&input.value.trim()!==''){input.value='';select.value='';}}});input.addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();const firstVisibleOption=dropdownOptions.querySelector('.dropdown-option:not(.hidden)');if(firstVisibleOption){firstVisibleOption.click();}}});});const forms=document.querySelectorAll('form');forms.forEach(form=>{form.addEventListener('submit',function(e){const searchInputs=this.querySelectorAll('.search-input');let preventSubmit=false;searchInputs.forEach(input=>{if(input.value.trim()!==''&&input.getAttribute('data-selection-made')==='false'){e.preventDefault();preventSubmit=true;input.style.borderColor='red';input.style.boxShadow='0 0 0 1px red';let errorMsg=input.parentNode.querySelector('.dropdown-error');if(!errorMsg){errorMsg=document.createElement('div');errorMsg.className='dropdown-error';errorMsg.style.color='red';errorMsg.style.fontSize='12px';errorMsg.style.marginTop='5px';input.parentNode.appendChild(errorMsg);}
errorMsg.textContent='الرجاء اختيار قيمة من القائمة المنسدلة';}});if(preventSubmit){const firstError=document.querySelector('.dropdown-error');if(firstError){firstError.scrollIntoView({behavior:'smooth',block:'center'});}}});});}});